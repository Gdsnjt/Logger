# シングルトンパターンの検証テスト

このディレクトリには、シングルトンパターンでLoggerを実装し、マルチプロセスでQueueが共有されるかを検証するコードが含まれています。

## ファイル構成

- `logger_singleton.py` - シングルトンパターンで実装したLoggerクラス
- `test_singleton.py` - 検証用のテストコード
- `logging_config.yaml` - ログ設定ファイル

## 実行方法

```bash
cd シングルトンテスト
python test_singleton.py
```

## 予想される結果

### 単一プロセスの場合
✅ シングルトンは正しく動作し、同じインスタンスが返されます

### マルチプロセスの場合
❌ 各プロセスで**別々のインスタンス**と**別々のQueue**が作成されます

## なぜシングルトンでも共有されないのか

1. **各プロセスは独立したメモリ空間を持つ**
   - `fork()`または`spawn()`で子プロセスが作成される際、親プロセスのメモリがコピーまたは新規作成されます
   - クラス変数（`_instance`）も各プロセスで独立しています

2. **multiprocessing.Queueは特殊なオブジェクト**
   - プロセス間通信（IPC）のために設計されています
   - 明示的に子プロセスに渡す必要があります（pickle化）
   - グローバル変数やクラス変数に入れても共有されません

3. **検証結果の確認ポイント**
   - 各プロセスの`インスタンスID`が異なる
   - 各プロセスの`QueueID`が異なる
   - コンソール出力で「新規初期化」が複数回表示される
   - ログファイルにワーカープロセスのログが記録されない可能性

## 結論

**シングルトンパターンを使っても、マルチプロセスでは明示的にQueueを渡す必要があります。**

現在の実装（`../logger.py`）のように、`log_queue`を引数で渡す方法が正しいアプローチです。
